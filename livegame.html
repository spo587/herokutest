<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src='https://dl.dropboxusercontent.com/u/95890750/set/set.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

<body>
    <h1> Set! </h1>
    <a href='/'> Return to home page </a><br>
    <button type='button' id='button1' class='button'> click me to start a new game </button>
    <br><button type='button' id='shuffle' onclick='shuffleBoardCards()'>click to shuffle the board</button>
    <br> number of people in game: <span id='numclients'> 1 </span>
    <br>your set count: <span id='setsFoundSelf'>0</span><br>
    opponent's set count: <span id='setsFoundOpponent'>0</span>
    <br>
    
    <div id='div1'></div>
    <ul id="messages"></ul>
    <form action="">
      <input id="m" autocomplete="off" /><button>Trash talk</button>
    </form>
    <script>
    var playerName;
    $(document).ready(function(){
        playerName = prompt("Your name please", '');
        //socket.emit('name entered');
    });
    // function assignVar(num){
    //         var socket = io('/livegame/' + String(num));
    //         return socket;
    //     }
    function doStuff(socket){

        socket.on('new connection', function(numPlayers){
            socket.emit('player name', playerName);
            socket.on('player name', function(name){
                alert(name + ' has joined! Either one of you can start the game');
                return false;
            });

            var current = $('#numclients').text();
            $('#numclients').text(String(numPlayers));
            if (numPlayers === 1){
                alert('wait for second player to join...');
                return false;
            }

        });

        
        socket.on('disconnect', function(numPlayers){
            var current = $('#numclients').text();
            $('#numclients').text(String(numPlayers));
        });
        socket.on('player has departed', function(){
            alert('the other player left :(');
            return false
        });
        $('#button1').click(function(){
            if ($('IMG').length > 0){

            }
            console.log('click');
            socket.emit('start game'); //$('#paragraph').html());
            //$('#paragraph').html('');

            return false;
        });
        $('form').submit(function(){
            var data = {playerName: playerName, msg: $('#m').val()}
            socket.emit('chat message', data);
            $('#m').val('');
            return false;
          });

        socket.on('chat message', function(data){
            //console.log('incoming message');
            $('#messages').append($('<li>').text(data.playerName + ':  ' + data.msg));
        });
        var deck;
        socket.on('order of deck', function(orderedDeck){
            var firstTwelve = orderedDeck.splice(0, 12);
            //console.log(firstTwelve);
            firstDeal(firstTwelve);
            deck = orderedDeck;
            //return orderedDeck;
        });
        socket.on('dealing next three', function(){
            console.log('dealing next three');
            var cardsOnBoard = cardnumarray_numbers();
            if (cardsOnBoard.length === 9){
                var cards = deck.splice(0, 3);
                dealThree(cards);
            }
            else {
                console.log('checking for deadboard');
                checkDeadboardAndDeal();
            }
        });
        socket.on('force deal next three', function(){
            var cards = deck.splice(0, 3)
            dealThree(cards);
        });
        socket.on('set found', function(cards){
            console.log('firing event');
            var current = $('#setsFoundOpponent').text();
            $('#setsFoundOpponent').text(String(Number(current) + 1));

            removeDeal(cards);
        });
        socket.on('cardClick', function(data){
            var id = data.card;
            var clicked = data.clicked;
            
            var card = $('#' + String(id))[0];
            //var currentColor = card.style.borderColor;
            changeBorderColor(card, 'red', 'black');
            
            if (clicked.length === 3) {
                //console.log(clicked);
                var clickedCardNums = clicked.map(function(current){
                    return convertCardBack(current);
                });
                var clickedCardDoms = clickedCardNums.map(function(current){
                    return $('#' + String(current))[0];
                });
                clickedCardDoms.forEach(function(current){
                    changeBorderColor(current, 'red', 'black')
                });
            }
        });

    }

    var socket = io('/livegame' + document.URL[document.URL.length - 1]);
    doStuff(socket);
    // socket.on('new connection', function(numPlayers){

    //     var current = $('#numclients')[0].value;
    //     $('#numclients')[0].value = String(numPlayers);
    //     if (numPlayers === 1){
    //         alert('wait for second player to join...');
    //     }

    // });
    // socket.on('new player', function(){
    //     alert('another player has joined! Either one of you can start the game');
    // });
    // socket.on('disconnect', function(numPlayers){
    //     var current = $('#numclients')[0].value;
    //     $('#numclients')[0].value = String(numPlayers);
    // });
    // socket.on('player has departed', function(){
    //     alert('the other player left :(');
    // });
    // $('#button1').click(function(){
    //     if ($('IMG').length > 0){

    //     }
    //     console.log('click');
    //     socket.emit('start game'); //$('#paragraph').html());
    //     //$('#paragraph').html('');

    //     return false;
    // });
    // $('form').submit(function(){
    //     socket.emit('chat message', $('#m').val());
    //     $('#m').val('');
    //     return false;
    //   });

    // socket.on('chat message', function(msg){
    //     console.log('incoming message');
    //     $('#messages').append($('<li>').text(msg));
    // });
    // var deck;
    // socket.on('order of deck', function(orderedDeck){
    //     var firstTwelve = orderedDeck.splice(0, 12);
    //     //console.log(firstTwelve);
    //     firstDeal(firstTwelve);
    //     deck = orderedDeck;
    //     //return orderedDeck;
    // });
    // socket.on('dealing next three', function(){
    //     //console.log(cards);
    //     var cards = deck.splice(0, 3);
    //     dealThree(cards);
    // });
    // socket.on('set found', function(cards){
    //     var current = $('#setsFoundOpponent')[0].value;
    //     $('#setsFoundOpponent')[0].value = String(Number(current) + 1);

    //     removeDeal(cards);
    // });
    // // var change = setInterval(function() { 
    // //     ObserveInputValue($('#setsFound').value; 
    // // }, 100);
    // // });
    </script>
</body>