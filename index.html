<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src='https://dl.dropboxusercontent.com/u/95890750/set/set.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

<body>
    <h1> Set! </h1>
    <p>Click on a link below to join a game</p>
    <p><a href='/oneplayer'>click here to play timed one player game</a></p>
    <p><a href='/besttime'> click to see best time</a></p>
    <div id='counter'></div>
    
    <script>
    for (var i=0; i<10; i++){
        newp = dom('A', {id: i, href: '/livegame' + String(i)});
        $('#counter').append(newp).append('<br>');

    }
    function forEachIn(object, func) {
        for (var property in object) {
            if (object.hasOwnProperty(property))
                func(property, object[property])
        }
    }
    var socket = io('/');
    var gameStatus = {};
    var games = [];
    for (var i=0; i<10; i++){
        games.push('livegame' + i);
    }
    games.forEach(function(current){
        gameStatus[current] = 'no players';
    });
    socket.on('player joined game', function(visitCounter){
        resetGameLinks(visitCounter);
        socket.on('player left game', function(visitCounter){
            resetGameLinks(visitCounter);
        });       
    });
    function resetGameLinks(visitCounter){
        forEachIn(visitCounter, function(prop, val){
            if (val === 1 && prop !== ''){
                gameStatus[prop] = 'player waiting';
                //gamesWaiting.push(prop);
            }
            else if (val === 2 && prop !== ''){
                gameStatus[prop] = 'game in progress';
            }
        });
        
        for (var i=0; i<10; i++){
            var p = $('#' + String(i));
            p.text('livegame ' + String(i) + ': ' + gameStatus['livegame' + String(i)]);
        }
    }
    </script>

</body>